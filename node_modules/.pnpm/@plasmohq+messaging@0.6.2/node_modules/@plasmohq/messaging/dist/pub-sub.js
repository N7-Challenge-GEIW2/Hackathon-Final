var c=globalThis.browser?.tabs||globalThis.chrome?.tabs,r=()=>{let t=globalThis.browser?.runtime||globalThis.chrome?.runtime;if(!t)throw new Error("Extension runtime is not available");return t};var s=()=>globalThis.__plasmoInternalHubMap,u=()=>{let t=r();if(!t.onConnectExternal)throw new Error("onConnect External not available. You need externally_connectable entry possibly");globalThis.__plasmoInternalHubMap=new Map;let e=s();t.onConnectExternal.addListener(n=>{let o=n.sender.tab.id;e.has(o)||(e.set(o,n),n.onMessage.addListener(a=>{i({from:o,payload:a})}),n.onDisconnect.addListener(()=>{e.delete(o)}))})},i=t=>{s().forEach((n,o)=>{o!==t.from&&n.postMessage({...t,to:o})})},m=t=>{let e=r();if(!e.connect)throw new Error("runtime.connect not available. You need to use startHub in BGSW");return e.connect(t)};export{i as broadcast,m as connectToHub,s as getHubMap,u as startHub};
