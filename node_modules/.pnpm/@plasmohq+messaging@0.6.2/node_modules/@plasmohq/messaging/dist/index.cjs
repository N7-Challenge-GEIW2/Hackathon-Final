var i=Object.defineProperty;var f=Object.getOwnPropertyDescriptor;var T=Object.getOwnPropertyNames;var R=Object.prototype.hasOwnProperty;var I=(e,a)=>{for(var t in a)i(e,t,{get:a[t],enumerable:!0})},P=(e,a,t,n)=>{if(a&&typeof a=="object"||typeof a=="function")for(let s of T(a))!R.call(e,s)&&s!==t&&i(e,s,{get:()=>a[s],enumerable:!(n=f(a,s))||n.enumerable});return e};var h=e=>P(i({},"__esModule",{value:!0}),e);var v={};I(v,{relay:()=>S,relayMessage:()=>u,sendToActiveContentScript:()=>E,sendToBackground:()=>x,sendToBackgroundViaRelay:()=>w,sendToContentScript:()=>M,sendViaRelay:()=>O});module.exports=h(v);var y=require("nanoid");var d=globalThis.browser?.tabs||globalThis.chrome?.tabs,m=()=>{let e=globalThis.browser?.runtime||globalThis.chrome?.runtime;if(!e)throw new Error("Extension runtime is not available");return e},g=()=>{if(!d)throw new Error("Extension tabs API is not available");return d},c=async()=>{let e=g(),[a]=await e.query({active:!0,currentWindow:!0});return a},l=(e,a)=>!a.__internal&&e.source===globalThis.window&&e.data.name===a.name&&(a.relayId===void 0||e.data.relayId===a.relayId);var b=(e,a,t=globalThis.window)=>{let n=async s=>{if(l(s,e)&&!s.data.relayed){let r={name:e.name,relayId:e.relayId,body:s.data.body},o=await a?.(r);t.postMessage({name:e.name,relayId:e.relayId,instanceId:s.data.instanceId,body:o,relayed:!0},{targetOrigin:e.targetOrigin||"/"})}};return t.addEventListener("message",n),()=>t.removeEventListener("message",n)},p=(e,a=globalThis.window)=>new Promise((t,n)=>{let s=(0,y.nanoid)(),r=new AbortController;a.addEventListener("message",o=>{l(o,e)&&o.data.relayed&&o.data.instanceId===s&&(t(o.data.body),r.abort())},{signal:r.signal}),a.postMessage({...e,instanceId:s},{targetOrigin:e.targetOrigin||"/"})});var x=async e=>m().sendMessage(e.extensionId??null,e),M=async e=>{let a=typeof e.tabId=="number"?e.tabId:(await c())?.id;if(!a)throw new Error("No active tab found to send message to.");return g().sendMessage(a,e)},E=M,u=e=>b(e,x),S=u,w=p,O=w;0&&(module.exports={relay,relayMessage,sendToActiveContentScript,sendToBackground,sendToBackgroundViaRelay,sendToContentScript,sendViaRelay});
