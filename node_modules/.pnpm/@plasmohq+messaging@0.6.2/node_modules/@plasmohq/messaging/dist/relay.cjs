var i=Object.defineProperty;var d=Object.getOwnPropertyDescriptor;var m=Object.getOwnPropertyNames;var c=Object.prototype.hasOwnProperty;var y=(a,e)=>{for(var t in e)i(a,t,{get:e[t],enumerable:!0})},b=(a,e,t,n)=>{if(e&&typeof e=="object"||typeof e=="function")for(let s of m(e))!c.call(a,s)&&s!==t&&i(a,s,{get:()=>e[s],enumerable:!(n=d(e,s))||n.enumerable});return a};var u=a=>b(i({},"__esModule",{value:!0}),a);var w={};y(w,{relay:()=>x,sendViaRelay:()=>p});module.exports=u(w);var g=require("nanoid");var h=globalThis.browser?.tabs||globalThis.chrome?.tabs;var l=(a,e)=>!e.__internal&&a.source===globalThis.window&&a.data.name===e.name&&(e.relayId===void 0||a.data.relayId===e.relayId);var x=(a,e,t=globalThis.window)=>{let n=async s=>{if(l(s,a)&&!s.data.relayed){let r={name:a.name,relayId:a.relayId,body:s.data.body},o=await e?.(r);t.postMessage({name:a.name,relayId:a.relayId,instanceId:s.data.instanceId,body:o,relayed:!0},{targetOrigin:a.targetOrigin||"/"})}};return t.addEventListener("message",n),()=>t.removeEventListener("message",n)},p=(a,e=globalThis.window)=>new Promise((t,n)=>{let s=(0,g.nanoid)(),r=new AbortController;e.addEventListener("message",o=>{l(o,a)&&o.data.relayed&&o.data.instanceId===s&&(t(o.data.body),r.abort())},{signal:r.signal}),e.postMessage({...a,instanceId:s},{targetOrigin:a.targetOrigin||"/"})});0&&(module.exports={relay,sendViaRelay});
