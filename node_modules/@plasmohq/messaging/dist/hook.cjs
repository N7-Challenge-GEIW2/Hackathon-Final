var m=Object.defineProperty;var x=Object.getOwnPropertyDescriptor;var R=Object.getOwnPropertyNames;var b=Object.prototype.hasOwnProperty;var f=(e,s)=>{for(var t in s)m(e,t,{get:s[t],enumerable:!0})},P=(e,s,t,n)=>{if(s&&typeof s=="object"||typeof s=="function")for(let o of R(s))!b.call(e,o)&&o!==t&&m(e,o,{get:()=>s[o],enumerable:!(n=x(s,o))||n.enumerable});return e};var w=e=>P(m({},"__esModule",{value:!0}),e);var S={};f(S,{useMessage:()=>v,useMessageRelay:()=>N,usePort:()=>I,useRelay:()=>L});module.exports=w(S);var a=require("react");var B=require("nanoid");var O=globalThis.browser?.tabs||globalThis.chrome?.tabs,i=()=>{let e=globalThis.browser?.runtime||globalThis.chrome?.runtime;if(!e)throw new Error("Extension runtime is not available");return e};var y=(e,s)=>!s.__internal&&e.source===globalThis.window&&e.data.name===s.name&&(s.relayId===void 0||e.data.relayId===s.relayId);var g=(e,s,t=globalThis.window)=>{let n=async o=>{if(y(o,e)&&!o.data.relayed){let r={name:e.name,relayId:e.relayId,body:o.data.body},d=await s?.(r);t.postMessage({name:e.name,relayId:e.relayId,instanceId:o.data.instanceId,body:d,relayed:!0},{targetOrigin:e.targetOrigin||"/"})}};return t.addEventListener("message",n),()=>t.removeEventListener("message",n)};var E=async e=>i().sendMessage(e.extensionId??null,e);var p=e=>g(e,E);var u=e=>{let s=async(n,o,r)=>{await e?.({...n,sender:o},{send:d=>r(d)})},t=(n,o,r)=>(s(n,o,r),!0);return i().onMessage.addListener(t),()=>{i().onMessage.removeListener(t)}};var c=new Map,T=e=>{let s=c.get(e);if(s)return s;let t=i().connect({name:e});return c.set(e,t),t},h=e=>{c.delete(e)},l=(e,s,t)=>{let n=T(e);function o(){h(e),t?.()}return n.onMessage.addListener(s),n.onDisconnect.addListener(o),{port:n,disconnect:()=>{n.onMessage.removeListener(s),n.onDisconnect.removeListener(o)}}};var v=e=>{let[s,t]=(0,a.useState)();return(0,a.useEffect)(()=>u(async(n,o)=>{t(n.body),await e(n,o)}),[e]),{data:s}},I=e=>{let s=(0,a.useRef)(),t=(0,a.useRef)(0),[n,o]=(0,a.useState)();return(0,a.useEffect)(()=>{if(!e)return null;let{port:r,disconnect:d}=l(e,M=>{o(M)},()=>{t.current=t.current+1});return s.current=r,d},[e,t.current]),{data:n,send:r=>{s.current.postMessage({name:e,body:r})},listen:r=>l(e,r)}};function N(e){(0,a.useEffect)(()=>p(e),[])}var L=(e,s)=>{let t=(0,a.useRef)();return(0,a.useEffect)(()=>(t.current=g(e,s),t.current),[]),()=>t.current?.()};0&&(module.exports={useMessage,useMessageRelay,usePort,useRelay});
