import{nanoid as l}from"nanoid";var g=globalThis.browser?.tabs||globalThis.chrome?.tabs;var i=(a,e)=>!e.__internal&&a.source===globalThis.window&&a.data.name===e.name&&(e.relayId===void 0||a.data.relayId===e.relayId);var y=(a,e,n=globalThis.window)=>{let r=async s=>{if(i(s,a)&&!s.data.relayed){let o={name:a.name,relayId:a.relayId,body:s.data.body},t=await e?.(o);n.postMessage({name:a.name,relayId:a.relayId,instanceId:s.data.instanceId,body:t,relayed:!0},{targetOrigin:a.targetOrigin||"/"})}};return n.addEventListener("message",r),()=>n.removeEventListener("message",r)},b=(a,e=globalThis.window)=>new Promise((n,r)=>{let s=l(),o=new AbortController;e.addEventListener("message",t=>{i(t,a)&&t.data.relayed&&t.data.instanceId===s&&(n(t.data.body),o.abort())},{signal:o.signal}),e.postMessage({...a,instanceId:s},{targetOrigin:a.targetOrigin||"/"})});export{y as relay,b as sendViaRelay};
